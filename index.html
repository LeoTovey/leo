<!DOCTYPE html>
<html lang="en">

<head>
	<title>three.js demo</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
	<link type="text/css" rel="stylesheet" href="main.css">
	<style>
		body {
			background-color: #bfe3dd;
			color: #000;
		}

		a {
			color: #2983ff;
		}
	</style>
</head>

<body oncontextmenu="return false">

	<div id="container"></div>

	<script type="module">


		import * as THREE from './three/build/three.module.js';

		import { OrbitControls } from './three/examples/jsm/controls/OrbitControls.js';
		import Particle from './Particle.js';
		import MassSpringSystem from './MassSpringSystem.js';
		let camera, scene, renderer;

		const frustumSize = 500;


		let aspect = window.innerWidth / window.innerHeight;
		camera = new THREE.OrthographicCamera(frustumSize * aspect / - 2, frustumSize * aspect / 2, frustumSize / 2, frustumSize / - 2, 1, 1000);

		camera.position.set(0, 0, 200);

		scene = new THREE.Scene();
		scene.background = new THREE.Color(0xf0f0f0);

		renderer = new THREE.WebGLRenderer();
		renderer.setPixelRatio(window.devicePixelRatio);
		renderer.setSize(window.innerWidth, window.innerHeight);
		document.body.appendChild(renderer.domElement);

		window.addEventListener('resize', onWindowResize);
		const massSystem = new MassSpringSystem()
		massSystem.minX = frustumSize * aspect / - 2;
		massSystem.maxX = frustumSize * aspect / 2;
		massSystem.maxY = frustumSize / 2;
		massSystem.minY = frustumSize / - 2;

		document.addEventListener('mousedown', click);

		animate();
		
		function onWindowResize() {

			aspect = window.innerWidth / window.innerHeight;

			camera.left = - frustumSize * aspect / 2;
			camera.right = frustumSize * aspect / 2;
			camera.top = frustumSize / 2;
			camera.bottom = - frustumSize / 2;

			massSystem.minX = frustumSize * aspect / - 2;
			massSystem.maxX = frustumSize * aspect / 2;
			massSystem.maxY = frustumSize / 2;
			massSystem.minY = frustumSize / - 2;

			camera.updateProjectionMatrix();

			renderer.setSize(window.innerWidth, window.innerHeight);
		}

		function animate() {

			requestAnimationFrame(animate);

			//console.log(window.innerWidth)
			massSystem.update();
			renderer.render(scene, camera);

		}

		const mouse = new THREE.Vector2();

		function click(event) {

			if (event.button == 2) {


				mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
				mouse.y = - (event.clientY / window.innerHeight) * 2 + 1;

				massSystem.addParticle(scene, new THREE.Vector2(mouse.x * frustumSize * aspect * 0.5, mouse.y * frustumSize * 0.5), false)
			}
		}
	</script>

</body>

</html>